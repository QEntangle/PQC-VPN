# strongSwan configuration for PQC VPN Hub
# /etc/strongswan.conf

strongswan {
    # Load additional plugins
    load_modular = yes
    
    # Plugin directory
    plugins {
        include /etc/strongswan.d/charon/*.conf
    }
    
    # Main daemon configuration
    charon {
        # Number of worker threads
        threads = 16
        
        # Enable file logging
        filelog {
            /var/log/strongswan.log {
                # Log level: -1=silent, 0=audit, 1=control, 2=diag, 3=raw, 4=debug
                default = 2
                append = no
                flush_line = yes
                time_format = %b %e %T
            }
            stderr {
                ike = 2
                knl = 3
                cfg = 2
            }
        }
        
        # System logging
        syslog {
            identifier = charon
            daemon {
                default = 1
            }
            auth {
                default = 1
            }
        }
        
        # Network settings
        network {
            # Enable IP forwarding
            ip_forwarding = yes
            
            # Ignore redirects
            ignore_redirects = yes
            
            # Accept source routing
            accept_source_routing = no
            
            # Enable NAT traversal
            nat_traversal = yes
        }
        
        # Plugin configuration
        plugins {
            # X.509 certificate plugin
            x509 {
                # Enable certificate validation
                enforce_critical = yes
            }
            
            # Revocation checking
            revocation {
                enable_crl = yes
                enable_ocsp = yes
            }
            
            # Random number generation
            random {
                urandom = /dev/urandom
                random = /dev/random
                strong_random = yes
            }
            
            # Socket configuration
            socket-default {
                # Use default port 500 for IKE
                port = 500
                # Use port 4500 for NAT traversal
                port_nat_t = 4500
                
                # Enable UDP encapsulation
                fwmark = !0x%mark
            }
            
            # Kernel interface
            kernel-netlink {
                # Enable hardware offloading if available
                hw_offload = yes
                
                # Buffer sizes
                buflen = 1500
                timeout = 0
                
                # Policy updates
                policy_update = yes
                
                # Receive buffer size
                receive_buffer_size = 0
                
                # Send buffer size  
                send_buffer_size = 0
            }
            
            # Certificate validation
            constraints {
                # Load certificate constraints
                load = yes
            }
            
            # Post-Quantum Cryptography plugins
            openssl {
                # Enable OpenSSL for PQC algorithms
                load = yes
                
                # Enable FIPS mode if available
                fips_mode = no
                
                # Engine configuration
                engine = yes
            }
            
            # PQC algorithm support
            botan {
                # Enable Botan for additional PQC support
                load = yes
            }
            
            # Memory management
            gcm {
                # Enable AES-GCM mode
                load = yes
            }
            
            # Curve25519 support
            curve25519 {
                load = yes
            }
            
            # ChaCha20/Poly1305 support
            chapoly {
                load = yes
            }
            
            # Network manager integration
            networkmanager {
                load = no
            }
            
            # Unity extensions
            unity {
                load = yes
            }
            
            # XAUTH support
            xauth-generic {
                load = yes
            }
            
            # EAP methods
            eap-identity {
                load = yes
            }
            
            eap-mschapv2 {
                load = yes
            }
            
            eap-tls {
                load = yes
            }
            
            # Dead peer detection
            dpd {
                delay = 30s
                timeout = 150s
                action = restart
            }
            
            # Load balancing
            ha {
                # High availability support
                load = no
            }
            
            # SQL database support
            sql {
                load = no
            }
            
            # PKCS#11 support
            pkcs11 {
                load = no
            }
            
            # TPM support
            tpm {
                load = no
            }
        }
        
        # DNS configuration
        dns1 = 8.8.8.8
        dns2 = 1.1.1.1
        
        # NBNS configuration
        nbns1 = 8.8.8.8
        nbns2 = 1.1.1.1
        
        # Multiple authentication rounds
        multiple_authentication = no
        
        # Hash and URL encoding
        hash_and_url = no
        
        # Cookie threshold
        cookie_threshold = 30
        
        # DH exponent length
        dh_exponent_ansi_x9_42 = no
        
        # Retransmission settings
        retransmit_tries = 3
        retransmit_timeout = 4.0
        retransmit_base = 1.8
        retransmit_jitter = 0
        retransmit_limit = 0
        
        # Fragment size
        fragment_size = 1280
        
        # Maximum number of half-open connections
        max_concurrent_half_open = 250
        
        # Block threshold
        block_threshold = 5
        
        # Close threshold
        close_ike_on_child_failure = no
        
        # Integrity check
        integrity_test = no
        
        # Crypto self-test
        crypto_test = {
            # Enable crypto tests
            on_add = no
            on_create = no
            required = no
        }
        
        # Process routing priority
        priority_boost = {
            # Boost priority for time-critical threads
            high = 2
            medium = 1
            low = 0
        }
        
        # Flush auth_lifetime
        flush_auth_cfg = no
        
        # Ignore acquire TS
        ignore_acquire_ts = no
        
        # Install routes
        install_routes = yes
        
        # Install virtual IP
        install_virtual_ip = yes
        
        # Keep alive interval
        keep_alive = 20s
        
        # Maximum number of redirects
        max_redirects = 5
        
        # Prefer configured proposals
        prefer_configured_proposals = yes
        
        # Prefer temporary addresses
        prefer_temporary_addrs = no
        
        # Process priority
        process_route = yes
        
        # Receive delay
        receive_delay = 0
        
        # Receive delay type
        receive_delay_type = 0
        
        # Replay window size
        replay_window = 32
        
        # Send delay
        send_delay = 0
        
        # Send delay type  
        send_delay_type = 0
        
        # Send vendor ID
        send_vendor_id = no
        
        # Signature authentication
        signature_authentication = yes
        
        # SPD socket
        spd_socket = unix:///var/run/spd.sock
        
        # Strict CRL policy
        strict_crl_policy = yes
        
        # Trust router certificates
        trust_router_certs = no
        
        # Use MOBIKE
        mobike = yes
        
        # User certificate
        user_certificate = no
        
        # Vendor ID
        vendor_id = strongSwan
    }
    
    # Plugin loader configuration
    load_modular = yes
    
    # Include additional configuration files
    include /etc/strongswan.d/*.conf
}

# Legacy pluto configuration (disabled)
pluto {
}